---
weight: 10
sourceSHA: 382827880236b07157954d816fe602b7548bc6b9e4534710efad32b3bea1ad5b
---

# 创建实例

您可以创建一个 Kafka 实例，以建立一个高吞吐量、低延迟的实时数据管道，以支持在流数据处理和服务解耦等场景中各种业务系统的多样化需求。

## 创建 Kafka 实例

### 步骤

<Tabs>
  <Tab label="命令行">
    通过命令行创建 Kafka 实例：

    ```bash
    cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: RdsKafka
    metadata:
      name: my-cluster
    spec:
      entityOperator:
        topicOperator:
          resources:
            limits:
              cpu: 1
              memory: 2Gi
            requests:
              cpu: 1
              memory: 2Gi
        userOperator:
          resources:
            limits:
              cpu: 1
              memory: 2Gi
            requests:
              cpu: 1
              memory: 2Gi
        tlsSidecar:
          resources:
            limits:
              cpu: 200m
              memory: 128Mi
            requests:
              cpu: 200m
              memory: 128Mi
      version: 3.8
      replicas: 3
      config:
        auto.create.topics.enable: "false"
        auto.leader.rebalance.enable: "true"
        background.threads: "10"
        compression.type: producer
        default.replication.factor: "3"
        delete.topic.enable: "true"
        log.retention.hours: "168"
        log.roll.hours: "168"
        log.segment.bytes: "1073741824"
        message.max.bytes: "1048588"
        min.insync.replicas: "1"
        num.io.threads: "8"
        num.network.threads: "3"
        num.recovery.threads.per.data.dir: "1"
        num.replica.fetchers: "1"
        unclean.leader.election.enable: "false"
      resources:
        limits:
          cpu: 2
          memory: 4Gi
        requests:
          cpu: 2
          memory: 4Gi
      storage:
        size: 1Gi
        # 使用可用存储类替代
        class: local-path
        deleteClaim: false
      kafka:
        listeners:
          plain: {}
          external:
            type: nodeport
            tls: false
      zookeeper:
        # 目前与 Kafka 代理相同
        replicas: 3
        resources:
          limits:
            cpu: 1
            memory: 2Gi
          requests:
            cpu: 1
            memory: 2Gi
        # 存储与 Kafka 代理保持一致
        storage:
          size: 1Gi
          # 使用可用存储类替代
          class: local-path
          deleteClaim: false
    EOF
    ```
  </Tab>

  <Tab label="Web 控制台">
    1. 点击左侧导航栏中的 **Kafka**。

    2. 点击 ***命名空间名称***。

    3. 点击 **创建 Kafka 实例**。

    4. 根据以下说明完成相关配置。

           <table border="">
             <tr>
               <th style={{width: '100px'}}>配置项</th>
               <th style={{width: '130px'}}>配置项</th>
               <th>描述</th>
             </tr>

             <tr>
               <td><b>参数配置</b></td>
               <td><b>参数模板</b></td>
               <td>您可以选择系统或自定义参数模板。有关自定义参数模板，请参考 <a href="/appservice/unified-om/para-template/custom-template">参数模板</a>。</td>
             </tr>

             <tr>
               <td rowspan="2"><b>Kafka 节点</b></td>
               <td><b>代理节点数</b></td>
               <td>为确保代理的高可用性，每个代理将在集群中的不同节点上调度。</td>
             </tr>

             <tr>
               <td><b>存储类</b></td>
               <td>如果下拉列表中没有可用的存储类，请联系平台管理员添加一个。</td>
             </tr>

             <tr>
               <td rowspan="2"><b>访问方式</b></td>
               <td><b>认证方式</b></td>
               <td>为确保数据传输安全，建议启用加密认证。例如：监听方式为 TLS，认证方式为 SCRAM - SHA - 512。</td>
             </tr>

             <tr>
               <td><b>指定主机端口</b></td>
               <td>当使用 NodePort 访问集群并打开指定主机端口时，您可以指定服务端口号。 <br /><b>注意</b>：在更新实例时，端口不可互换。如果需要交换端口，您可以先更新到另一个空闲的端口，然后重新指定。</td>
             </tr>

             <tr>
               <td rowspan="2"><b>调度配置</b></td>
               <td><b>节点标签</b></td>
               <td>通过标签过滤当前集群中的可用节点。Pods 将调度到可用节点上。 <br /><b>注意</b>：实例创建后，此配置不再允许修改。</td>
             </tr>

             <tr>
               <td><b>Pod 容忍</b></td>
               <td>如果可用节点被标记，只有设置了容忍的 Pods 才能容忍这些标记，并可以调度到与 Pod 容忍和节点标记匹配的节点。匹配规则如下：<ul><li><b>完全匹配</b>：当 Pod 容忍的 <i>key</i>、<i>value</i>、<i>effect</i> 完全匹配节点标记中设置的值时，Pod 将容忍该节点标记。</li><li><b>存在</b>：当 Pod 容忍的 <i>key</i>、<i>effect</i> 与节点标记中的值匹配时，Pod 将容忍该节点标记。</li></ul> <br /><b>描述</b>：效应决定了不容忍节点标记的 Pods 是否会被分配到具有这些标记的节点。例如，NoExecute 效应表示，只有容忍这些标记的 Pods（包括来自该 Kafka 实例的 Pods）可以被调度，并将驱逐在该节点上已运行但不容忍这些标记的 Pods（来自其他实例）。有关匹配规则的更多信息，请参见 <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">Kubernetes 官方文档</a>。</td>
             </tr>
           </table>

    5. 点击 **创建**。

       当实例状态更改为 **运行中**，表示实例已成功创建。
  </Tab>
</Tabs>

创建实例后，您可以使用以下命令检查实例的状态：

```bash
$ kubectl get rdskafka -n <namespace> -o=custom-columns=NAME:.metadata.name,VERSION:.spec.version,STATUS:.status.phase,MESSAGE:.status.reason,CreationTimestamp:.metadata.creationTimestamp
NAME         VERSION   STATUS   MESSAGE                                   CreationTimestamp
my-cluster   3.8       Active   <none>                                    2025-03-06T08:46:57Z
test38       3.8       Failed   Pod is unschedulable or is not starting   2025-03-06T08:46:36Z
```

输出表字段的含义如下：

| 字段             | 描述                                                                                                                                                                                                                                                                                                                                                                                                             |
| :---------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| NAME              | 实例名称                                                                                                                                                                                                                                                                                                                                                                                                           |
| VERSION           | 目前仅支持以下4个版本：`2.5.0`、`2.7.0`、`2.8.2`、`3.8`                                                                                                                                                                                                                                                                                                                                              |
| STATUS            | 当前实例的状态，可能包括以下状态： <ul><li>`Creating`：实例正在创建</li><li>`Updating`：实例正在更新</li><li>`Failed`：实例遇到不可恢复的错误</li><li>`Paused`：实例已被手动暂停</li><li>`Restarting`：实例正在重启</li><li>`Active`：实例已准备好使用</li></ul> |
| MESSAGE           | 实例当前状态的原因                                                                                                                                                                                                                                                                                                                                                                            |
| CreationTimestamp | 实例创建的时间戳                                                                                                                                                                                                                                                                                                                                                                             |

## 特殊场景

<Directive type="warning" title="重要提示">
  创建实例时建议将代理节点数设置为 **3**。如果您的代理节点数少于建议值 **3**，则在创建时您需要修改某些参数：
</Directive>

<Tabs>
  <Tab label="命令行">
    通过命令行创建单节点 Kafka 实例：

    ```bash
    cat << EOF | kubectl -n default create -f -
    apiVersion: middleware.alauda.io/v1
    kind: RdsKafka
    metadata:
      name: my-cluster
    spec:
      entityOperator:
        topicOperator:
          resources:
            limits:
              cpu: 1
              memory: 2Gi
            requests:
              cpu: 1
              memory: 2Gi
        userOperator:
          resources:
            limits:
              cpu: 1
              memory: 2Gi
            requests:
              cpu: 1
              memory: 2Gi
        tlsSidecar:
          resources:
            limits:
              cpu: 200m
              memory: 128Mi
            requests:
              cpu: 200m
              memory: 128Mi
      version: 3.8
      replicas: 1
      config:
        auto.create.topics.enable: "false"
        auto.leader.rebalance.enable: "true"
        background.threads: "10"
        compression.type: producer
        delete.topic.enable: "true"
        log.retention.hours: "168"
        log.roll.hours: "168"
        log.segment.bytes: "1073741824"
        message.max.bytes: "1048588"
        min.insync.replicas: "1"
        num.io.threads: "8"
        num.network.threads: "3"
        num.recovery.threads.per.data.dir: "1"
        num.replica.fetchers: "1"
        unclean.leader.election.enable: "false"
        ## 确保下面参数配置正确
        default.replication.factor: "1"
        offsets.topic.replication.factor: 1
        transaction.state.log.replication.factor: 1
        transaction.state.log.min.isr: 1
      resources:
        limits:
          cpu: 2
          memory: 4Gi
        requests:
          cpu: 2
          memory: 4Gi
      storage:
        size: 1Gi
        # 使用可用存储类替代
        class: local-path
        deleteClaim: false
      kafka:
        listeners:
          plain: {}
          external:
            type: nodeport
            tls: false
      zookeeper:
        # 目前与 Kafka 代理相同
        replicas: 1
        resources:
          limits:
            cpu: 1
            memory: 2Gi
          requests:
            cpu: 1
            memory: 2Gi
        # 存储与 Kafka 代理保持一致
        storage:
          size: 1Gi
          # 使用可用存储类替代
          class: local-path
          deleteClaim: false
    EOF
    ```
  </Tab>

  <Tab label="Web 控制台">
    1. 点击左侧导航栏中的 **Kafka**。

    2. 点击 ***命名空间名称***。

    3. 点击 **创建 Kafka 实例**。

    4. 点击 **展开实例参数**，并将以下参数值设置为 **1**：

           <table border="">
             <tr>
               <th style={{width: '150px'}}>参数</th>
               <th>配置值</th>
               <th>描述</th>
             </tr>

             <tr>
               <td>`default.replication.factor`</td>
               <td>1</td>
               <td>自动创建主题的副本因子</td>
             </tr>

             <tr>
               <td>`offsets.topic.replication.factor`</td>
               <td>1</td>
               <td>偏移主题的副本数</td>
             </tr>

             <tr>
               <td>`transaction.state.log.replication.factor`</td>
               <td>1</td>
               <td>事务状态日志的副本数</td>
             </tr>

             <tr>
               <td>`transaction.state.log.min.isr`</td>
               <td>1</td>
               <td>事务状态日志的最小同步副本数</td>
             </tr>
           </table>

    5. 完成其他配置。

    6. 点击 **创建**。

       当实例状态更改为 **运行中**，表示实例已成功创建。
  </Tab>
</Tabs>

---
weight: 40
---

# 客户端文件配置
为确保通信安全，请务必在 Kafka 客户端上完成加密传输相关配置。

:::info 注意事项
下述操作请在集群中 **控制节点** 上进行。
:::

## 所需文件预览

请根据 Kafka 实例的认证类型准备文件，每个文件与 Kafka 实例均为一一对应关系。存在多个实例时，需分别配置文件，且可将相关文件分别放在不同路径下。对于集群内访问的场景，客户端路径以 `/home/kafka` 为例。

| 加密方式              | 认证方式           | 所需文件                        |
|-----------------------|--------------------|---------------------------------|
| 集群内：TLS<br/>集群外：TLS | SCRAM-SHA-512 或无 | CA 证书：`ca.p12`<br/>客户端配置文件：`client-ssl.properties` |
| 集群内：TLS<br/>集群外：TLS | TLS                | CA 证书：`ca.p12`<br/>用户证书：`user.p12`<br/>客户端配置文件：`client-ssl.properties` |

## 一、配置 CA 证书 

1. 生成 CA 证书。

    ```
    $ kubectl -n {Kafka 实例所在命名空间} get secret {Kafka 实例名称}-cluster-ca-cert -o jsonpath='{.data.ca\.p12}' | base64 -d > ca.p12
    ```
2. 生成 CA 证书的密码。请记录此密码。

    ```
    $ kubectl -n {Kafka 实例所在命名空间} get secret {Kafka 实例名称}-cluster-ca-cert -o jsonpath='{.data.ca\.password}' | base64 -d
    ```

## 二、用户证书 

1. 生成用户证书。

    ```
    $ kubectl -n {Kafka 实例所在命名空间} get secret {Kafka 用户名称} -o jsonpath='{.data.user\.p12}' | base64 -d > user.p12
    ```

2. 生成用户证书的密码。请记录此密码。

    ```
    $ kubectl -n {Kafka 实例所在命名空间} get secret {Kafka 用户名称} -o jsonpath='{.data.user\.password}' | base64 -d
    ```

## 三、配置客户端配置文件

### client-ssl.properties （无认证）


```
$ cat << EOF > client-ssl.properties
security.protocol=SSL
ssl.truststore.type=PKCS12
ssl.truststore.location=/home/kafka/ca.p12
ssl.truststore.password={CA 证书密码}
EOF
```

### client.properties （用于 SCRAM-SHA-512 认证） 

**前提**：在 **用户管理** 页签，单击保密字典并记录其中 **password** 字段取值。


```
$ cat << EOF > client.properties
security.protocol=SASL_SSL
ssl.truststore.type=PKCS12
ssl.truststore.location=/home/kafka/ca.p12
ssl.truststore.password={CA 证书的密码}

sasl.mechanism=SCRAM-SHA-512
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
    username="{Kafka 用户名称}" \
    password="{Kafka 用户密码}";

EOF
```

### client-ssl.properties （用于 TLS 认证）


```
$ cat << EOF > client-ssl.properties
security.protocol=SSL
ssl.truststore.type=PKCS12
ssl.truststore.location={客户端所在路径}/ca.p12
ssl.truststore.password={CA 证书密码}

ssl.keystore.type=PKCS12
ssl.keystore.location=/home/kafka/user.p12
ssl.keystore.password={用户证书密码}
EOF
```


```
$ cat << EOF > client-ssl.properties
security.protocol=SSL
ssl.truststore.type=PKCS12
ssl.truststore.location={客户端所在路径}/ca.p12
ssl.truststore.password={CA 证书密码}

ssl.keystore.type=PKCS12
ssl.keystore.location={客户端所在路径}/user.p12
ssl.keystore.password={用户证书密码}
EOF
```
:::tip
集群外配置文件中增加`ssl.endpoint.identification.algorithm=`
:::

## 四、将文件拷贝至客户端

**提示**：请参考所需文件预览中的表格，确定您访问方式的所需文件。

**集群内访问**

需确保所需文件放在客户端配置文件中提及的路径下。

```
$ kubectl cp ./{所需文件名称} {Kafka 客户端所在命名空间}/{Kafka 客户端 Pod 名称}:/home/kafka/ -c kafka
```

**集群外访问**

需确保所需文件放在客户端配置文件中提及的路径下。